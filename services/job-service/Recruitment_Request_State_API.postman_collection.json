{
	"info": {
		"_postman_id": "recruitment-request-state-api",
		"name": "Recruitment Request State API",
		"description": "Collection kiểm thử các API xử lý trạng thái ở job-service.\n\nCác biến chung:\n- `baseUrl`: địa chỉ job-service (mặc định http://localhost:8083)\n- `token`: JWT Bearer token\n- `requestId`: ID yêu cầu đã tạo (dùng cho submit/approve/return/cancel)\n\nLuồng mẫu:\n1. Tạo yêu cầu ở trạng thái DRAFT\n2. Submit yêu cầu (có thể chỉ định workflow cụ thể hoặc để hệ thống tự chọn)\n3. Approve/Forward/Reject bước hiện tại\n4. Return → Edit → Resubmit\n5. Withdraw (rút lại) nếu cần\n6. Cancel nếu cần\n\nLưu ý:\n- Forward: Người trung gian chỉ chuyển tiếp (stepActionType = FORWARD)\n- Approve: Người cuối cùng mới là approve (stepActionType = APPROVE)\n- Withdraw: Chỉ submitter/owner mới có thể rút lại khi đang SUBMITTED/PENDING",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8083"
		},
		{
			"key": "token",
			"value": ""
		},
		{
			"key": "requestId",
			"value": ""
		}
	],
	"item": [
		{
			"name": "1. Create Recruitment Request (Draft)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"title\": \"Tuyển Senior Developer\",\n  \"numberOfPositions\": 2,\n  \"priorityLevel\": \"HIGH\",\n  \"reason\": \"Thay thế nhân sự nghỉ việc\",\n  \"description\": \"Phiên bản test\",\n  \"departmentId\": 1,\n  \"jobCategoryId\": 1,\n  \"requesterId\": 10,\n  \"workflowId\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests"
					]
				},
				"description": "Tạo yêu cầu tuyển dụng ở trạng thái DRAFT. `workflowId` có thể null để hệ thống tự chọn khi submit.\n\nSau khi tạo, cập nhật biến `requestId` bằng ID trả về."
			},
			"response": []
		},
		{
			"name": "2. Submit Request",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"workflowId\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/submit",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"submit"
					]
				},
				"description": "Submit yêu cầu từ DRAFT/RETURNED sang SUBMITTED. Nếu muốn chỉ định workflow cụ thể, truyền giá trị `workflowId`."
			},
			"response": []
		},
		{
			"name": "3. Approve Current Step",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"approvalNotes\": \"Đồng ý phê duyệt\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/approve",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"approve"
					]
				},
				"description": "Approver phê duyệt bước hiện tại.\n- Nếu còn bước tiếp theo → chuyển sang bước đó.\n- Nếu là bước cuối cùng → workflow-service gửi event WORKFLOW_COMPLETED → request chuyển sang APPROVED."
			},
			"response": []
		},
		{
			"name": "3b. Reject Current Step",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"reason\": \"Không đáp ứng yêu cầu\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/reject",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"reject"
					]
				},
				"description": "Reject: Từ chối ở bước này → request chuyển sang REJECTED, kết thúc luồng.\n\nKhác với Cancel:\n- Reject: Từ chối ở bước cụ thể (chỉ khi đang SUBMITTED/PENDING)\n- Cancel: Hủy yêu cầu (có thể hủy từ DRAFT, SUBMITTED, PENDING, RETURNED)"
			},
			"response": []
		},
		{
			"name": "4. Return Request (về bước đầu)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"reason\": \"Thiếu thông tin ngân sách, vui lòng bổ sung\",\n  \"returnedToStepId\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/return",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"return"
					]
				},
				"description": "Reviewer trả yêu cầu về bước đầu tiên (requester/submitter). `returnedToStepId = null` = trả về bước đầu.\n\nRequest chuyển trạng thái RETURNED. Các bước đã qua sẽ bị invalidate."
			},
			"response": []
		},
		{
			"name": "4b. Return Request (về bước cụ thể)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"reason\": \"Cần chỉnh sửa lại thông tin ở bước 1\",\n  \"returnedToStepId\": 123\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/return",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"return"
					]
				},
				"description": "Trả yêu cầu về một bước cụ thể (ví dụ: bước 1). Thay `returnedToStepId` bằng stepId thực tế.\n\nVí dụ: Bước 2 muốn trả về bước 1 → set `returnedToStepId = stepId của bước 1`."
			},
			"response": []
		},
		{
			"name": "4c. Submit lại sau Return",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"workflowId\": null\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/submit",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"submit"
					]
				},
				"description": "Sau khi bị return, owner/submitter chỉnh sửa và submit lại.\n\nWorkflow-service sẽ tự động tạo tracking từ `returnedToStepId` (nếu có) hoặc từ bước đầu tiên."
			},
			"response": []
		},
		{
			"name": "5. Cancel Request",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"reason\": \"Hủy vì không còn nhu cầu\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/cancel",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"cancel"
					]
				},
				"description": "Cancel: Hủy yêu cầu (có thể ở bất kỳ trạng thái nào, trừ APPROVED/REJECTED).\n\nKhác với Reject:\n- Reject: Từ chối ở bước cụ thể (chỉ khi đang SUBMITTED/PENDING)\n- Cancel: Hủy yêu cầu (có thể hủy từ DRAFT, SUBMITTED, PENDING, RETURNED)\n\nTrạng thái chuyển sang CANCELLED và workflow-service sẽ invalidate tất cả tracking đang pending."
			},
			"response": []
		},
		{
			"name": "5b. Withdraw Request",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"reason\": \"Rút lại vì thay đổi kế hoạch\"\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}/actions/withdraw",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}",
						"actions",
						"withdraw"
					]
				},
				"description": "Withdraw: Rút lại yêu cầu (chỉ submitter/owner mới có thể).\n\nĐiều kiện:\n- Chỉ có thể withdraw khi đang SUBMITTED hoặc PENDING\n- Chỉ submitter hoặc owner mới có thể withdraw\n\nKhác với Cancel:\n- Withdraw: Rút lại (chỉ submitter/owner, chỉ khi SUBMITTED/PENDING)\n- Cancel: Hủy yêu cầu (bất kỳ ai có quyền, ở nhiều trạng thái hơn)\n\nTrạng thái chuyển sang WITHDRAWN và workflow-service sẽ invalidate tất cả tracking đang pending."
			},
			"response": []
		},
		{
			"name": "4d. Edit Request (sau Return)",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"title\": \"Tuyển Senior Developer (đã chỉnh sửa)\",\n  \"numberOfPositions\": 2,\n  \"priorityLevel\": \"HIGH\",\n  \"reason\": \"Thay thế nhân sự nghỉ việc - đã bổ sung thông tin\",\n  \"description\": \"Phiên bản đã chỉnh sửa sau khi bị return\",\n  \"departmentId\": 1,\n  \"jobCategoryId\": 1,\n  \"requesterId\": 10\n}"
				},
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}"
					]
				},
				"description": "Sau khi bị return, owner/submitter có thể chỉnh sửa yêu cầu.\n\nRequest vẫn giữ nguyên status = RETURNED cho đến khi submit lại.\n\nLuồng: Returned → Edit → Resubmit"
			},
			"response": []
		},
		{
			"name": "6. Get Request Detail (with workflow info)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{token}}",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{baseUrl}}/api/v1/job-service/recruitment-requests/{{requestId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"api",
						"v1",
						"job-service",
						"recruitment-requests",
						"{{requestId}}"
					]
				},
				"description": "Xem chi tiết yêu cầu kèm thông tin:\n- Requester/Approver\n- Workflow đang sử dụng (nếu có)\n- Các bước approval tracking\n- Bước hiện tại đang xử lý\n\nResponse sẽ có thêm field `workflowInfo` chứa:\n- `workflow`: Thông tin workflow (tên, mô tả, các bước)\n- `approvalTrackings`: Danh sách các bước đã xử lý/đang chờ\n- `currentStepId`: ID bước hiện tại đang pending"
			},
			"response": []
		}
	]
}


